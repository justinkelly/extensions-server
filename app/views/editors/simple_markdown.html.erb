<!DOCTYPE html>
<html>
<head>
  <%= javascript_include_tag 'marked' %>
  <style>
  body, html {
    font-family: sans-serif;
    white-space: nowrap;
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  #wrapper {
    font-size: 16px;
    display: flex;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #editor {
    width: 50%;

    font-size: 16px;
    height: 100%;
    border: 0px;
    outline: 0;
    vertical-align: top;
    resize: none;
    padding: 12px;
    padding-top: 25px;
    margin-bottom: 0 !important;
  }

  #preview {
    width: 50%;
    height: 100%;
    border-left: 1px solid rgb(228, 228, 228);
    vertical-align: top;
    padding: 10px;
    overflow: scroll;
  }

  </style>

  <script>

    window.addEventListener("message", function(){
      window.noteText = event.data.text || "";
      window.noteId = event.data.id;
      document.getElementById("editor").value = window.noteText;
      document.getElementById("preview").innerHTML = marked(window.noteText);
    }, false);

    document.addEventListener("DOMContentLoaded", function(event) {
      window.parent.postMessage({status: "ready"}, '*');

      marked.setOptions({
        gfm: true,
        tables: true,
        breaks: false,
        pedantic: false,
        sanitize: false,
        smartLists: true,
        smartypants: false
      });

      document.getElementById("editor").addEventListener("input", function(event){
        var text = event.target.value;

        document.getElementById("preview").innerHTML = marked(text);

        if(window.parent != window) {
          window.parent.postMessage({text: text, id: window.noteId}, '*');
        }
      })
    });

  </script>
</head>
<body>
  <div id="wrapper">
    <textarea id="editor"></textarea><div id="preview"></preview>
  </div>
</body>
</html>
